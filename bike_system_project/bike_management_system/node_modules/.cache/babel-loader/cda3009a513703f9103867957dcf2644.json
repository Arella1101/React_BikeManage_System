{"ast":null,"code":"import \"antd/lib/transfer/style/css\";\nimport _Transfer from \"antd/lib/transfer\";\nimport \"antd/lib/input/style/css\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/card/style/css\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/button/style/css\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/modal/style/css\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/tree/style/css\";\nimport _Tree from \"antd/lib/tree\";\nimport \"antd/lib/select/style/css\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/form/style/css\";\nimport _Form from \"antd/lib/form\";\nvar _jsxFileName = \"C:\\\\Users\\\\Shuwen\\\\bike_system\\\\src\\\\pages\\\\permission\\\\index.js\";\nimport React from 'react';\nimport axios from '../../axios/index';\nimport ETable from '../../components/ETable/index';\nimport menuConfig from '../../config/menuConfig';\nimport Utils from '../../utils/utils';\nconst FormItem = _Form.Item;\nconst Option = _Select.Option;\nconst TreeNode = _Tree.TreeNode;\nexport default class Permission extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {};\n\n    this.requestList = () => {\n      axios.ajax({\n        url: '/role/list',\n        data: {\n          params: {}\n        }\n      }).then(res => {\n        if (res.code == 0) {\n          let list = res.result.item_list.map((item, i) => {\n            item.key = i;\n            return item;\n          });\n          this.setState({\n            list\n          });\n        }\n      });\n    };\n\n    this.handleRole = () => {\n      this.setState({\n        isRoleVisible: true\n      });\n    };\n\n    this.handleRoleSubmit = () => {\n      let data = this.roleForm.props.form.getFieldsValue();\n      axios.ajax({\n        url: 'role/create',\n        data: {\n          params: { ...data\n          }\n        }\n      }).then(res => {\n        if (res) {\n          this.setState({\n            isRoleVisible: false\n          });\n          this.requestList();\n        }\n      });\n    };\n\n    this.handlePermission = () => {\n      if (!this.state.selectedItem) {\n        _Modal.info({\n          title: '信息',\n          content: '请选择一个角色'\n        });\n\n        return;\n      }\n\n      this.setState({\n        isPermVisible: true,\n        detailInfo: this.state.selectedItem\n      });\n      let menuList = this.state.selectedItem.menus;\n      this.setState({\n        menuInfo: menuList\n      });\n    };\n\n    this.handlePermEditSubmit = values => {\n      let data = values;\n      data.role_id = this.state.selectedItem.id;\n      data.menus = this.state.menuInfo;\n      axios.ajax({\n        url: '/permission/edit',\n        data: {\n          params: { ...data\n          }\n        }\n      }).then(res => {\n        if (res) {\n          this.setState({\n            isPermVisible: false\n          });\n          this.requestList();\n        }\n      });\n    };\n\n    this.handleUserAuth = () => {\n      if (!this.state.selectedItem) {\n        _Modal.info({\n          title: '信息',\n          content: '未选中任何项目'\n        });\n\n        return;\n      }\n\n      this.getRoleUserList(this.state.selectedItem.id);\n      this.setState({\n        isUserVisible: true,\n        isAuthClosed: false,\n        detailInfo: this.state.selectedItem\n      });\n    };\n\n    this.getRoleUserList = id => {\n      axios.ajax({\n        url: '/role/user_list',\n        data: {\n          params: {\n            id: id\n          }\n        }\n      }).then(res => {\n        if (res) {\n          this.getAuthUserList(res.result);\n        }\n      });\n    };\n\n    this.getAuthUserList = dataSource => {\n      const mockData = [];\n      const targetKeys = [];\n\n      if (dataSource && dataSource.length > 0) {\n        for (let i = 0; i < dataSource.length; i++) {\n          const data = {\n            key: dataSource[i].user_id,\n            title: dataSource[i].user_name,\n            status: dataSource[i].status\n          };\n\n          if (data.status == 1) {\n            targetKeys.push(data.key);\n          }\n\n          mockData.push(data);\n        }\n      }\n\n      this.setState({\n        mockData,\n        targetKeys\n      });\n    };\n\n    this.patchUserInfo = targetKeys => {\n      this.setState({\n        targetKeys: targetKeys\n      });\n    };\n\n    this.handleUserSubmit = () => {\n      let data = {};\n      data.user_ids = this.state.targetKeys || [];\n      data.role_id = this.state.selectedItem.id;\n      axios.ajax({\n        url: '/role/user_role_edit',\n        data: {\n          params: { ...data\n          }\n        }\n      }).then(res => {\n        if (res) {\n          this.setState({\n            isUserVisible: false\n          });\n          this.requestList();\n        }\n      });\n    };\n  }\n\n  componentWillMount() {\n    this.requestList();\n  }\n\n  render() {\n    const columns = [{\n      title: '角色ID',\n      dataIndex: 'id'\n    }, {\n      title: '角色名称',\n      dataIndex: 'role_name'\n    }, {\n      title: '创建时间',\n      dataIndex: 'create_time',\n      render: Utils.formatTime\n    }, {\n      title: '使用状态',\n      dataIndex: 'status',\n\n      render(status) {\n        if (status == 1) {\n          return \"启用\";\n        } else {\n          return \"停用\";\n        }\n      }\n\n    }, {\n      title: '授权时间',\n      dataIndex: 'authorize_time',\n      render: Utils.formatTime\n    }, {\n      title: '授权人',\n      dataIndex: 'authorize_user_name'\n    }];\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        width: '100%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(_Card, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.handleRole,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 21\n      }\n    }, \"\\u521B\\u5EFA\\u89D2\\u8272\"), /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.handlePermission,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 21\n      }\n    }, \"\\u8BBE\\u7F6E\\u6743\\u9650\"), /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.handleUserAuth,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 21\n      }\n    }, \"\\u7528\\u6237\\u6388\\u6743\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content-wrap\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ETable, {\n      updateSelectedItem: Utils.updateSelectedItem.bind(this),\n      selectedRowKeys: this.state.selectedRowKeys,\n      dataSource: this.state.list,\n      columns: columns,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(_Modal, {\n      title: \"\\u521B\\u5EFA\\u89D2\\u8272\",\n      visible: this.state.isRoleVisible,\n      onOk: this.handleRoleSubmit,\n      onCancel: () => {\n        this.roleForm.props.form.resetFields();\n        this.setState({\n          isRoleVisible: false\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(RoleForm, {\n      wrappedComponentRef: inst => this.roleForm = inst,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(_Modal, {\n      title: \"\\u6743\\u9650\\u8BBE\\u7F6E\",\n      visible: this.state.isPermVisible,\n      width: 600,\n      onOk: this.handlePermEditSubmit,\n      onCancel: () => {\n        this.setState({\n          isPermVisible: false\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(PermEditForm, {\n      wrappedComponentRef: inst => this.roleForm = inst,\n      detailInfo: this.state.detailInfo,\n      menuInfo: this.state.menuInfo || [],\n      patchMenuInfo: checkedKeys => {\n        this.setState({\n          menuInfo: checkedKeys\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(_Modal, {\n      title: \"\\u7528\\u6237\\u6388\\u6743\",\n      visible: this.state.isUserVisible,\n      width: 800,\n      onOk: this.handleUserSubmit,\n      onCancel: () => {\n        this.setState({\n          isUserVisible: false\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(RoleAuthForm, {\n      wrappedComponentRef: inst => this.userAuthForm = inst,\n      isClosed: this.state.isAuthClosed,\n      detailInfo: this.state.detailInfo,\n      targetKeys: this.state.targetKeys,\n      mockData: this.state.mockData,\n      patchUserInfo: this.patchUserInfo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 25\n      }\n    })));\n  }\n\n} // 角色创建\n\nclass RoleForm extends React.Component {\n  render() {\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 16\n      }\n    };\n    return /*#__PURE__*/React.createElement(_Form, {\n      layout: \"horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\"\n    }, formItemLayout, {\n      name: \"role_name\",\n      initialValue: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Input, {\n      type: \"text\",\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u89D2\\u8272\\u540D\\u79F0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 29\n      }\n    })), /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u72B6\\u6001\"\n    }, formItemLayout, {\n      name: \"state\",\n      initialValue: \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Select, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Option, {\n      value: 1,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 29\n      }\n    }, \"\\u5F00\\u542F\"), /*#__PURE__*/React.createElement(Option, {\n      value: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 29\n      }\n    }, \"\\u5173\\u95ED\"))));\n  }\n\n} // 设置权限\n\n\nclass PermEditForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {};\n\n    this.onCheck = checkedKeys => {\n      this.props.patchMenuInfo(checkedKeys);\n    };\n\n    this.renderTreeNodes = (data, key = '') => {\n      return data.map(item => {\n        let parentKey = key + item.key;\n\n        if (item.children) {\n          return /*#__PURE__*/React.createElement(TreeNode, {\n            title: item.title,\n            key: parentKey,\n            dataRef: item,\n            className: \"op-role-tree\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 21\n            }\n          }, this.renderTreeNodes(item.children, parentKey));\n        } else if (item.btnList) {\n          return /*#__PURE__*/React.createElement(TreeNode, {\n            title: item.title,\n            key: parentKey,\n            dataRef: item,\n            className: \"op-role-tree\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 21\n            }\n          }, this.renderBtnTreedNode(item, parentKey));\n        }\n\n        return /*#__PURE__*/React.createElement(TreeNode, Object.assign({}, item, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 20\n          }\n        }));\n      });\n    };\n\n    this.renderBtnTreedNode = (menu, parentKey = '') => {\n      const btnTreeNode = [];\n      menu.btnList.forEach(item => {\n        console.log(parentKey + '-btn-' + item.key);\n        btnTreeNode.push( /*#__PURE__*/React.createElement(TreeNode, {\n          title: item.title,\n          key: parentKey + '-btn-' + item.key,\n          className: \"op-role-tree\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 30\n          }\n        }));\n      });\n      return btnTreeNode;\n    };\n  }\n\n  render() {\n    const {\n      getFieldDecorator\n    } = this.props.form;\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 18\n      }\n    };\n    const detail_info = this.props.detailInfo;\n    const menuInfo = this.props.menuInfo;\n    return /*#__PURE__*/React.createElement(_Form, {\n      layout: \"horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\\uFF1A\"\n    }, formItemLayout, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Input, {\n      disabled: true,\n      maxLength: \"8\",\n      placeholder: detail_info.role_name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u72B6\\u6001\\uFF1A\"\n    }, formItemLayout, {\n      initialValue: \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Select, {\n      style: {\n        width: 80\n      },\n      placeholder: \"\\u542F\\u7528\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Option, {\n      value: \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 29\n      }\n    }, \"\\u542F\\u7528\"), /*#__PURE__*/React.createElement(Option, {\n      value: \"0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 29\n      }\n    }, \"\\u505C\\u7528\"))), /*#__PURE__*/React.createElement(_Tree, {\n      checkable: true,\n      defaultExpandAll: true,\n      onCheck: checkedKeys => this.onCheck(checkedKeys),\n      checkedKeys: menuInfo || [],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(TreeNode, {\n      title: \"\\u5E73\\u53F0\\u6743\\u9650\",\n      key: \"platform_all\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 21\n      }\n    }, this.renderTreeNodes(menuConfig))));\n  }\n\n} // 用户授权\n\n\nclass RoleAuthForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    this.filterOption = (inputValue, option) => {\n      return option.title.indexOf(inputValue) > -1;\n    };\n\n    this.handleChange = targetKeys => {\n      this.props.patchUserInfo(targetKeys);\n    };\n  }\n\n  render() {\n    const formItemLayout = {\n      labelCol: {\n        span: 5\n      },\n      wrapperCol: {\n        span: 18\n      }\n    };\n    const detail_info = this.props.detailInfo;\n    return /*#__PURE__*/React.createElement(_Form, {\n      layout: \"horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u89D2\\u8272\\u540D\\u79F0\\uFF1A\"\n    }, formItemLayout, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Input, {\n      disabled: true,\n      maxLength: 8,\n      placeholder: detail_info.role_name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(FormItem, Object.assign({\n      label: \"\\u9009\\u62E9\\u7528\\u6237\\uFF1A\"\n    }, formItemLayout, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(_Transfer, {\n      listStyle: {\n        width: 200,\n        height: 400\n      },\n      dataSource: this.props.mockData,\n      showSearch: true,\n      titles: ['待选用户', '已选用户'],\n      searchPlaceholder: \"\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n      filterOption: this.filterOption,\n      targetKeys: this.props.targetKeys,\n      onChange: this.handleChange,\n      render: item => item.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 21\n      }\n    })));\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Shuwen/bike_system/src/pages/permission/index.js"],"names":["React","axios","ETable","menuConfig","Utils","FormItem","Item","Option","TreeNode","Permission","Component","state","requestList","ajax","url","data","params","then","res","code","list","result","item_list","map","item","i","key","setState","handleRole","isRoleVisible","handleRoleSubmit","roleForm","props","form","getFieldsValue","handlePermission","selectedItem","info","title","content","isPermVisible","detailInfo","menuList","menus","menuInfo","handlePermEditSubmit","values","role_id","id","handleUserAuth","getRoleUserList","isUserVisible","isAuthClosed","getAuthUserList","dataSource","mockData","targetKeys","length","user_id","user_name","status","push","patchUserInfo","handleUserSubmit","user_ids","componentWillMount","render","columns","dataIndex","formatTime","width","updateSelectedItem","bind","selectedRowKeys","resetFields","inst","checkedKeys","userAuthForm","RoleForm","formItemLayout","labelCol","span","wrapperCol","PermEditForm","onCheck","patchMenuInfo","renderTreeNodes","parentKey","children","btnList","renderBtnTreedNode","menu","btnTreeNode","forEach","console","log","getFieldDecorator","detail_info","role_name","RoleAuthForm","filterOption","inputValue","option","indexOf","handleChange","height"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport {Card, Button, Form, Input, Select, Tree, Transfer, Modal} from 'antd'\r\nimport axios from '../../axios/index'\r\nimport ETable from '../../components/ETable/index'\r\nimport menuConfig from '../../config/menuConfig'\r\nimport Utils from '../../utils/utils'\r\nconst FormItem = Form.Item;\r\nconst Option = Select.Option;\r\nconst TreeNode = Tree.TreeNode;\r\nexport default class Permission extends React.Component{\r\n\r\n    state={}\r\n\r\n    componentWillMount(){\r\n        this.requestList();   \r\n    }\r\n\r\n    requestList = ()=>{\r\n        axios.ajax({\r\n            url:'/role/list',\r\n            data:{\r\n                params:{}\r\n            }\r\n        }).then((res)=>{\r\n            if(res.code == 0){\r\n                let list  = res.result.item_list.map((item,i)=>{\r\n                    item.key = i;\r\n                    return item;\r\n                })\r\n                this.setState({\r\n                    list\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    // 角色创建\r\n    handleRole = ()=>{\r\n        this.setState({\r\n            isRoleVisible:true\r\n        })\r\n    }\r\n\r\n    // 角色提交\r\n    handleRoleSubmit = ()=>{\r\n        let data = this.roleForm.props.form.getFieldsValue();\r\n        axios.ajax({\r\n            url:'role/create',\r\n            data:{\r\n                params:{\r\n                    ...data\r\n                }\r\n            }\r\n        }).then((res)=>{\r\n            if(res){\r\n                this.setState({\r\n                    isRoleVisible:false\r\n                })\r\n                this.requestList();\r\n            }\r\n        })\r\n    }\r\n\r\n    handlePermission = ()=>{\r\n        if (!this.state.selectedItem) {\r\n            Modal.info({\r\n                title: '信息',\r\n                content: '请选择一个角色'\r\n            })\r\n            return;\r\n        }\r\n        this.setState({\r\n            isPermVisible: true,\r\n            detailInfo: this.state.selectedItem\r\n        });\r\n        let menuList = this.state.selectedItem.menus;\r\n        this.setState({\r\n            menuInfo:menuList\r\n        })\r\n    }\r\n\r\n    handlePermEditSubmit = values=>{\r\n        let data = values;\r\n        data.role_id = this.state.selectedItem.id;\r\n        data.menus = this.state.menuInfo;\r\n        axios.ajax({\r\n            url:'/permission/edit',\r\n            data:{\r\n                params:{\r\n                    ...data\r\n                }\r\n            }\r\n        }).then((res)=>{\r\n            if(res){\r\n                this.setState({\r\n                    isPermVisible:false\r\n                })\r\n                this.requestList();\r\n            }\r\n        })\r\n    }\r\n\r\n    // 用户授权\r\n    handleUserAuth = ()=>{\r\n        if (!this.state.selectedItem) {\r\n            Modal.info({\r\n                title: '信息',\r\n                content: '未选中任何项目'\r\n            })\r\n            return;\r\n        }\r\n        this.getRoleUserList(this.state.selectedItem.id);\r\n        this.setState({\r\n            isUserVisible: true,\r\n            isAuthClosed: false,\r\n            detailInfo: this.state.selectedItem\r\n        });\r\n    }\r\n    getRoleUserList = (id)=>{\r\n        axios.ajax({\r\n            url:'/role/user_list',\r\n            data:{\r\n                params:{\r\n                    id:id\r\n                }\r\n            }\r\n        }).then((res)=>{\r\n            if(res){\r\n                this.getAuthUserList(res.result);\r\n            }\r\n        })\r\n    }\r\n    // 筛选目标用户\r\n    getAuthUserList = (dataSource) => {\r\n        const mockData = [];\r\n        const targetKeys = [];\r\n        if (dataSource && dataSource.length > 0) {\r\n            for (let i = 0; i < dataSource.length; i++) {\r\n                const data = {\r\n                    key: dataSource[i].user_id,\r\n                    title: dataSource[i].user_name,\r\n                    status: dataSource[i].status,\r\n                };\r\n                if (data.status == 1) {\r\n                    targetKeys.push(data.key);\r\n                }\r\n                mockData.push(data);\r\n            }\r\n        }\r\n        this.setState({mockData, targetKeys});\r\n    };\r\n    \r\n    patchUserInfo = (targetKeys) => {\r\n        this.setState({\r\n            targetKeys: targetKeys\r\n        });\r\n    };\r\n\r\n    // 用户授权提交\r\n    handleUserSubmit = ()=>{\r\n        let data = {};\r\n        data.user_ids = this.state.targetKeys || [];\r\n        data.role_id = this.state.selectedItem.id;\r\n        axios.ajax({\r\n            url:'/role/user_role_edit',\r\n            data:{\r\n                params:{\r\n                    ...data\r\n                }\r\n            }\r\n        }).then((res)=>{\r\n            if(res){\r\n                this.setState({\r\n                    isUserVisible:false\r\n                })\r\n                this.requestList();\r\n            }\r\n        })\r\n    }\r\n    render(){\r\n        const columns = [\r\n            {\r\n                title: '角色ID',\r\n                dataIndex: 'id'\r\n            }, {\r\n                title: '角色名称',\r\n                dataIndex: 'role_name'\r\n            },{\r\n                title: '创建时间',\r\n                dataIndex: 'create_time',\r\n                render: Utils.formatTime\r\n            }, {\r\n                title: '使用状态',\r\n                dataIndex: 'status',\r\n                render(status){\r\n                    if (status == 1) {\r\n                        return \"启用\"\r\n                    } else {\r\n                        return \"停用\"\r\n                    }\r\n                }\r\n            }, {\r\n                title: '授权时间',\r\n                dataIndex: 'authorize_time',\r\n                render: Utils.formatTime\r\n            }, {\r\n                title: '授权人',\r\n                dataIndex: 'authorize_user_name',\r\n            }\r\n        ];\r\n        return (\r\n            <div style={{width:'100%'}}>\r\n                <Card>\r\n                    <Button type=\"primary\" onClick={this.handleRole}>创建角色</Button>\r\n                    <Button type=\"primary\" onClick={this.handlePermission}>设置权限</Button>\r\n                    <Button type=\"primary\" onClick={this.handleUserAuth}>用户授权</Button>\r\n                </Card>           \r\n                <div className=\"content-wrap\">\r\n                    <ETable\r\n                        updateSelectedItem={Utils.updateSelectedItem.bind(this)}\r\n                        selectedRowKeys={this.state.selectedRowKeys}\r\n                        dataSource={this.state.list}\r\n                        columns={columns}\r\n                    />\r\n                </div>\r\n                <Modal\r\n                    title=\"创建角色\"\r\n                    visible={this.state.isRoleVisible}\r\n                    onOk={this.handleRoleSubmit}\r\n                    onCancel={()=>{\r\n                        this.roleForm.props.form.resetFields();\r\n                        this.setState({\r\n                            isRoleVisible:false\r\n                        })\r\n                    }}\r\n                >\r\n                    <RoleForm wrappedComponentRef={(inst) => this.roleForm = inst }/>\r\n                </Modal>\r\n                <Modal\r\n                       title=\"权限设置\"\r\n                       visible={this.state.isPermVisible}\r\n                       width={600}\r\n                       onOk={this.handlePermEditSubmit}\r\n                       onCancel={()=>{\r\n                           this.setState({\r\n                               isPermVisible:false\r\n                           })\r\n                       }}>\r\n                        <PermEditForm\r\n                            wrappedComponentRef={(inst) => this.roleForm = inst }\r\n                            detailInfo={this.state.detailInfo}\r\n                            menuInfo={this.state.menuInfo||[]}\r\n                            patchMenuInfo={(checkedKeys)=>{\r\n                                this.setState({\r\n                                    menuInfo: checkedKeys\r\n                                });\r\n                            }}\r\n                        />\r\n                </Modal>\r\n                <Modal\r\n                       title=\"用户授权\"\r\n                       visible={this.state.isUserVisible}\r\n                       width={800}\r\n                       onOk={this.handleUserSubmit}\r\n                       onCancel={()=>{\r\n                           this.setState({\r\n                               isUserVisible:false\r\n                           })\r\n                       }}>\r\n                        <RoleAuthForm\r\n                            wrappedComponentRef={(inst) => this.userAuthForm = inst }\r\n                            isClosed={this.state.isAuthClosed}\r\n                            detailInfo={this.state.detailInfo}\r\n                            targetKeys={this.state.targetKeys}\r\n                            mockData={this.state.mockData}\r\n                            patchUserInfo={this.patchUserInfo}\r\n                        />\r\n                </Modal>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n// 角色创建\r\nclass RoleForm extends React.Component{\r\n\r\n    render(){\r\n      \r\n        const formItemLayout = {\r\n            labelCol: {span: 5},\r\n            wrapperCol: {span: 16}\r\n        };\r\n        return (\r\n            <Form layout=\"horizontal\" >\r\n                <FormItem label=\"角色名称\" {...formItemLayout} name=\"role_name\" initialValue=''>\r\n                    {\r\n                        (\r\n                            <Input type=\"text\" placeholder=\"请输入角色名称\"/>\r\n                        )\r\n                    }\r\n                </FormItem>\r\n                <FormItem label=\"状态\" {...formItemLayout} name=\"state\" initialValue='1'>\r\n                    {\r\n                       (\r\n                        <Select>\r\n                            <Option value={1}>开启</Option>\r\n                            <Option value={0}>关闭</Option>\r\n                        </Select>\r\n                    )}\r\n                </FormItem>\r\n            </Form>\r\n        );\r\n    }\r\n}\r\n\r\n// 设置权限\r\nclass PermEditForm extends React.Component {\r\n    state = {};\r\n    // 设置选中的节点，通过父组件方法再传递回来\r\n    onCheck = (checkedKeys) => {\r\n        this.props.patchMenuInfo(checkedKeys);\r\n    };\r\n    renderTreeNodes = (data,key='') => {\r\n        return data.map((item) => {\r\n            let parentKey = key+item.key;\r\n            if (item.children) {\r\n                return (\r\n                    <TreeNode title={item.title} key={parentKey} dataRef={item} className=\"op-role-tree\">\r\n                        {this.renderTreeNodes(item.children,parentKey)}\r\n                    </TreeNode>\r\n                );\r\n            } else if (item.btnList) {\r\n                return (\r\n                    <TreeNode title={item.title} key={parentKey} dataRef={item} className=\"op-role-tree\">\r\n                        { this.renderBtnTreedNode(item,parentKey) }\r\n                    </TreeNode>\r\n                );\r\n            }\r\n            return <TreeNode {...item} />;\r\n        });\r\n    };\r\n\r\n    renderBtnTreedNode = (menu,parentKey='')=> {\r\n        const btnTreeNode = []\r\n        menu.btnList.forEach((item)=> {\r\n            console.log(parentKey+'-btn-'+item.key);\r\n            btnTreeNode.push(<TreeNode title={item.title} key={parentKey+'-btn-'+item.key} className=\"op-role-tree\"/>);\r\n        })\r\n        return btnTreeNode;\r\n    }\r\n\r\n    render() {\r\n        const { getFieldDecorator } = this.props.form;\r\n        const formItemLayout = {\r\n            labelCol: {span: 5},\r\n            wrapperCol: {span: 18}\r\n        };\r\n        const detail_info = this.props.detailInfo;\r\n        const menuInfo = this.props.menuInfo;\r\n        return (\r\n            <Form layout=\"horizontal\">\r\n                <FormItem label=\"角色名称：\" {...formItemLayout}>\r\n                    <Input disabled maxLength=\"8\" placeholder={detail_info.role_name}/>\r\n                </FormItem>\r\n                <FormItem label=\"状态：\" {...formItemLayout} initialValue='1'>\r\n                    {(\r\n                        <Select style={{ width: 80}}\r\n                                placeholder=\"启用\"\r\n                        >\r\n                            <Option value=\"1\">启用</Option>\r\n                            <Option value=\"0\">停用</Option>\r\n                        </Select>\r\n                    )}\r\n                </FormItem>\r\n                <Tree\r\n                    checkable\r\n                    defaultExpandAll\r\n                    onCheck={(checkedKeys)=>this.onCheck(checkedKeys)}\r\n                    checkedKeys={menuInfo ||[]}\r\n                >\r\n                    <TreeNode title=\"平台权限\" key=\"platform_all\">\r\n                        {this.renderTreeNodes(menuConfig)}\r\n                    </TreeNode>\r\n                </Tree>\r\n            </Form>\r\n        )\r\n    }\r\n}\r\n\r\n\r\n\r\n// 用户授权\r\nclass RoleAuthForm extends React.Component {\r\n\r\n    filterOption = (inputValue, option) => {\r\n        return option.title.indexOf(inputValue) > -1;\r\n    };\r\n    handleChange = (targetKeys) => {\r\n        this.props.patchUserInfo(targetKeys);\r\n    };\r\n\r\n    render() {\r\n        const formItemLayout = {\r\n            labelCol: {span: 5},\r\n            wrapperCol: {span: 18}\r\n        };\r\n        const detail_info = this.props.detailInfo;\r\n        return (\r\n            <Form layout=\"horizontal\">\r\n                <FormItem label=\"角色名称：\" {...formItemLayout}>\r\n                    <Input disabled maxLength={8} placeholder={detail_info.role_name}/>\r\n                </FormItem>\r\n                <FormItem label=\"选择用户：\" {...formItemLayout}>\r\n                    <Transfer\r\n                        listStyle={{width: 200,height: 400}}\r\n                        dataSource={this.props.mockData}\r\n                        showSearch\r\n                        titles={['待选用户', '已选用户']}\r\n                        searchPlaceholder='输入用户名'\r\n                        filterOption={this.filterOption}\r\n                        targetKeys={this.props.targetKeys}\r\n                        onChange={this.handleChange}\r\n                        render={item => item.title}\r\n                    />\r\n                </FormItem>\r\n            </Form>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}